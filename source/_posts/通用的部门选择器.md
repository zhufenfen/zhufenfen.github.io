---
title: é€šç”¨çš„éƒ¨é—¨é€‰æ‹©å™¨
date: 2022-06-29 20:13:19
tags:
header-img: https://images.pexels.com/photos/12079516/pexels-photo-12079516.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2
---

æœ€è¿‘åˆ†åˆ°äº†ä¸€ä¸ªä¸¥å³»çš„ä»»åŠ¡ï¼Œæ¥åˆ°è¿™ä¸ªä»»åŠ¡æ—¶ä¸€ç­¹è«å±•ã€‚æŠ€æœ¯æ–¹æ¡ˆåšäº†ä¸€å‘¨ä¹Ÿè§‰å¾—ä¸æ˜¯æˆ‘èƒ½åšå¾—äº†çš„äº‹ï¼Œå¥½éš¾å‘€å¥½æƒ³æ”¾å¼ƒï¼Œä»¿ä½›è‡ªå·±åœ¨é£å£æµªå°–ä¸Šï¼Œè¿›é€€ä¸¤éš¾ã€‚åªèƒ½å’¬å’¬ç‰™ï¼ŒåšæŒä¸€å¤©ç®—ä¸€å¤©ã€‚æµ…æµ…è®°å½•ä¸€ä¸‹ï½

## éœ€æ±‚èƒŒæ™¯
é¡¹ç›®ä¸­éƒ¨é—¨çˆ¶å­è”åŠ¨å…³ç³»ä¸æ»¡è¶³å½“å‰æŸäº›ä½¿ç”¨åœºæ™¯ï¼ˆæ¯”å¦‚åªæƒ³é€‰ä¸­çˆ¶éƒ¨é—¨ä¸‹æ•°æ®ï¼Œæˆ–è€…å–æ¶ˆé€‰ä¸­å­éƒ¨é—¨ä¸ä¼šå½±å“çˆ¶éƒ¨é—¨é€‰ä¸­çŠ¶æ€ï¼‰ç°éœ€å¼€å‘ä¸€ä¸ªå¯ä»¥è‡ªç”±é…ç½®æ¯ä¸ªèŠ‚ç‚¹è”åŠ¨å…³ç³»çš„éƒ¨é—¨ç»„ä»¶ï¼Œå¹¶å®ç°èŠ‚ç‚¹çš„å¼‚æ­¥åŠ è½½ã€‚ç»„ä»¶å¼€å‘å®Œä¹‹åï¼Œä¼šé€æ­¥æ›¿æ¢é¡¹ç›®é‡ŒåŸæœ‰çš„éƒ¨é—¨ã€‚å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼Œç°æœ‰çš„ç»„ä»¶åº“æ˜¾ç„¶æ˜¯ä¸èƒ½æ‹¿æ¥å³ç”¨çš„ï¼Œéš¾åŠäº†ğŸ˜…
<img src="/images/depart1.png" width=250 />
dropdownçš„å†…å®¹å¤§æ¦‚å¦‚ä¸‹ï¼Œè§¦å‘å™¨å¯ä»¥æ˜¯selectæˆ–filteræˆ–å…¶å®ƒbutton
<img src="/images/depart2.png" width=500 />

## è®¾è®¡åœºæ™¯
è¿™æ˜¯è¦å°è£…ä¸€ä¸ªé€šç”¨çš„éƒ¨é—¨ç»„ä»¶å‘€ï¼Œå†·é™ä¸€ä¸‹ï¼Œåˆ†æä¸‹é€»è¾‘åœºæ™¯ï¼Œæœ€ç»ˆå’ŒUIç¡®è®¤æ˜¯è¦å®ç°è¿™æ ·çš„ä¸€ä¸ªæ•ˆæœã€‚
- æ‡’åŠ è½½ï¼Œé¦–æ¬¡åŠ è½½ä¸¤çº§éƒ¨é—¨ï¼Œéšåæ¯æ¬¡ç‚¹å‡»åŒ…å«å­éƒ¨é—¨çš„å±•å¼€æ ‡è¯†åªåŠ è½½ä¸€çº§éƒ¨é—¨ã€‚å¦‚æœçˆ¶èŠ‚ç‚¹å«ä¸‹çº§ï¼Œåˆ™æ–°å±•å¼€çš„èŠ‚ç‚¹ä¹Ÿé»˜è®¤å‹¾é€‰ã€‚
- é¼ æ ‡æ‚¬æµ®åœ¨è¢«é€‰ä¸­çš„éƒ¨é—¨èŠ‚ç‚¹ä¸Šï¼ˆåŒ…æ‹¬å¶å­èŠ‚ç‚¹ï¼‰ï¼Œå³ä¾§ä¼šæ ¹æ®å½“å‰éƒ¨é—¨çš„å«/ä¸å«ä¸‹çº§çŠ¶æ€ï¼Œå±•ç¤ºå«/ä¸å«ä¸‹çº§æŒ‰é’®ã€‚
- å‹¾é€‰éƒ¨é—¨ï¼Œæ­¤æ—¶å½“å‰éƒ¨é—¨åŠæ‰€æœ‰ä¸‹çº§éƒ¨é—¨å…¨è¢«å‹¾é€‰ä¸”éƒ½æ˜¯å«ä¸‹çº§çŠ¶æ€ã€‚
- å–æ¶ˆå‹¾é€‰éƒ¨é—¨ï¼Œæ­¤æ—¶å½“å‰éƒ¨é—¨åŠæ‰€æœ‰ä¸‹çº§éƒ¨é—¨å…¨è¢«å–æ¶ˆå‹¾é€‰ã€‚æ‰€æœ‰ç¥–å…ˆéƒ¨é—¨éƒ½è°ƒæ•´ä¸ºä¸å«ä¸‹çº§çŠ¶æ€ã€‚
- ç‚¹å‡»å«ä¸‹çº§æŒ‰é’®ï¼Œæ­¤æ—¶å½“å‰éƒ¨é—¨çš„æ‰€æœ‰ä¸‹çº§éƒ¨é—¨å…¨è¢«å‹¾é€‰ä¸”éƒ½æ˜¯å«ä¸‹çº§çŠ¶æ€ã€‚
- ç‚¹å‡»ä¸å«ä¸‹çº§æŒ‰é’®ï¼Œæ­¤æ—¶å½“å‰éƒ¨é—¨çš„æ‰€æœ‰ä¸‹çº§éƒ¨é—¨éƒ½è¢«å–æ¶ˆå‹¾é€‰ã€‚æ‰€æœ‰ç¥–å…ˆéƒ¨é—¨éƒ½è°ƒæ•´ä¸ºä¸å«ä¸‹çº§çŠ¶æ€ã€‚
- Selectæ¡†çš„tagæ ‡ç­¾ï¼ŒåŒ…å«æ‰€æœ‰ä¸å«ä¸‹çº§çš„è¢«é€‰ä¸­éƒ¨é—¨ä»¥åŠå«ä¸‹çº§çš„é¡¶å±‚å¤´éƒ¨éƒ¨é—¨ã€‚Selectæ¡†çš„tagæ ‡ç­¾å¯¹åº”ç€éƒ¨é—¨æ ‘é€‰ä¸­æ•°æ®ï¼Œéƒ¨é—¨æ ‘æ•°æ®å˜åŠ¨ï¼ŒSelectæ¡†çš„tagæ ‡ç­¾ä¹Ÿéšä¹‹å˜åŠ¨ï¼ŒSelectæ¡†çš„æ•°æ®å˜åŠ¨ï¼Œéƒ¨é—¨æ ‘æ•°æ®ä¹Ÿéšä¹‹å˜åŠ¨ã€‚
- å‹¾é€‰æ˜¾ç¤ºå·²åœç”¨éƒ¨é—¨ï¼Œæ¸…ç©ºä¹‹å‰è¢«å‹¾é€‰çš„æ•°æ®ï¼Œé‡æ–°è¯·æ±‚æ•°æ®ã€‚å·²åœç”¨éƒ¨é—¨åä¼šæ–°å¢æ ‡è¯†ã€‚ï¼ˆå‰ç«¯ä¸åšç­›é€‰åŸå› ï¼šé»˜è®¤ä¸å±•ç¤ºå·²åœç”¨éƒ¨é—¨ï¼Œå¦‚æœæŸä¸ªéƒ¨é—¨çš„ä¸‹çº§éƒ¨é—¨å…¨æ˜¯å·²åœç”¨éƒ¨é—¨ï¼Œç”±äºåç«¯haveSubæ ‡è¯†ä¸ºtrueï¼Œåˆ™åœ¨é¡µé¢ç‚¹å‡»å±•å¼€æ¡†ä¼šå†è¯·æ±‚åŠ è½½ä¸€æ¬¡ï¼Œå´æ²¡å¾—åˆ°éƒ¨é—¨æ•°æ®ã€‚ï¼‰
<img src="/images/depart3.png" width=500 />
- æœç´¢æ—¶åšé˜²æŠ–å¤„ç†ï¼Œéƒ¨é—¨æ ‘æœç´¢å†…å®¹åšé«˜äº®å¤„ç†
<img src="/images/depart4.png" width=300 />
è¿˜æœ‰ç­‰ç­‰......æ€»ä¹‹ï¼Œä¹‹å‰éƒ¨é—¨é€‰æ‹©å™¨çš„åŠŸèƒ½è¿™é‡Œåªèƒ½å¤šï¼Œä¸èƒ½å°‘...

## æŠ€æœ¯æ–¹æ¡ˆ
éœ€æ±‚å¼€å‘å‰ï¼Œå½“ç„¶è¦åšæŠ€æœ¯æ–¹æ¡ˆå•¦ã€‚å®³ï¼Œå·¥ä½œä¸¤ä¸‰å¹´ç¬¬ä¸€æ¬¡åšæŠ€æœ¯æ–¹æ¡ˆï¼Œè¿˜å¥½æœ‰æ¨¡ç‰ˆå¯ä»¥ç…§è‘«èŠ¦ç”»ç“¢ã€‚ç»„ä»¶é¦–å…ˆéœ€è¦è€ƒè™‘å­—æ®µçš„ä¸€äº›è®¾è®¡ï¼Œç»„ä»¶æ¥æ”¶çš„propä»¥åŠå¯¹å¤–ä¼ é€’çš„æ•°æ®ã€‚èŠ±äº†è›®ä¹…çš„æ—¶é—´ç ”ç©¶æ•´ç†äº†ä¸‹ï¼Œå¯èƒ½è¿˜æ˜¯ä¼šæœ‰é—æ¼... ç°æœ‰çš„ç»„ä»¶propsé˜”ä»¥é€šè¿‡selectPropå’ŒfilterPropä¼ é€’è¿›æ¥ï¼Œç®—æ˜¯ç•™ä¸€ä¸ªå…¥å£å§ã€‚
<img src="/images/depart5.jpg" width=800 />
ç”¨TSå®šä¹‰äº†ç»„ä»¶çš„éƒ¨é—¨æ ‘æ•°æ®ä»¥åŠå‰åç«¯å’Œç»„ä»¶å¯¹å¤–ä¼ é€’çš„æ•°æ®æ ¼å¼ï¼Œåœ¨ç»„ä»¶å†…éƒ¨ä¸»è¦å·¥ä½œæ˜¯å¯¹è¿™äº›æ•°æ®è¿›è¡Œé€»è¾‘åˆ¤æ–­å¤„ç†ã€‚ç”±äºç»„ä»¶selectå±•ç¤ºçš„æ•°æ®å’Œtreeé€‰ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ä¼šç»´æŠ¤ä¸¤å¥—æ•°æ®ã€‚ä¸€ä¸ªæ˜¯æ‰€æœ‰å‹¾é€‰çš„keysï¼Œå¦ä¸€ä¸ªæ˜¯éƒ¨é—¨å›æ˜¾æ•°æ®æ ¼å¼ã€‚
```ts
// éƒ¨é—¨æ ‘æ•°æ®
export interface DepartTreeData {
  orgId: number;
  name: string;
  haveUsed?: HAVE_USED;
  hasAuth?: boolean;
  haveSub?: boolean;
  path?: string;
  children?: DepartTreeData[];
  [key: string]: unknown;
}

export interface DepartValue {
  orgId: number;
  name: string;
  includeSub?: boolean;
}

// å‰åç«¯ä¼ é€’çš„æ•°æ®æ ¼å¼
export type AsyncDepartmentValue<M> = (M extends true ? DepartValue[] : DepartValue) | undefined;

export type AsyncDepartmentValueOption<M> =
  | (M extends true ? DepartTreeData[] : DepartTreeData)
  | undefined;

// æ‰€æœ‰å‹¾é€‰çš„keys
export type CheckedKeys<M> = (M extends true ? number[] : number) | null | undefined;

// éƒ¨é—¨å›æ˜¾æ•°æ®æ ¼å¼
export type CheckValueMap = Map<number, { name: string; includeSub?: boolean }>;
```

## å…·ä½“å®ç°
æ¥ä¸‹æ¥å°±æ˜¯å…·ä½“å®ç°è¿‡ç¨‹å•¦ï¼Œä¹Ÿè›®ç…ç†¬çš„ï¼Œä»¿ä½›åœ¨è€ƒéªŒä¸€ä¸ªå‰ç«¯åŒå­¦çš„ç®—æ³•èƒ½åŠ›ï¼Œè®°å¾—åˆšå…¥èŒçš„æ—¶å€™é¢ç®—æ³•ï¼Œå°±ä¸å¤ªä¼šï¼Œé¢è¯•å®˜å¤¸æˆ‘**è¯šå®**ğŸ˜„

è¯è¯´å›æ¥ï¼Œåˆ°åº•æ€ä¹ˆå®ç°å‘¢ã€‚å…¶å®ä¸»è¦æ˜¯å–æ¶ˆå‹¾é€‰/å‹¾é€‰æˆ–ç‚¹å‡»å«/ä¸å«ä¸‹çº§çš„ä¸€äº›è”åŠ¨é€»è¾‘å¤„ç†ï¼Œéœ€è¦å¤„ç†ä¸¤å¥—æ•°æ®ã€‚ä¸€ç‚¹ä¸€ç‚¹æ…¢æ…¢ç¢ç£¨å…¶ä¸­çš„å¥¥å¦™ï¼Œç»ˆäºæœ‰ä¸€å¤©èŒ…å¡é¡¿å¼€ï¼Œå’”å’”å’”ä¸€é¡¿å†™ï¼Œä»¿ä½›å®ç°äº†ï¼Œå“ˆå“ˆï¼è¿™é‡Œæµ…æµ…è®°å½•ä¸€ä¸‹ä½¿ç”¨çš„æ–¹æ³•
```ts
/**
 * å–æ¶ˆå‹¾é€‰/å‹¾é€‰ç¥–å…ˆèŠ‚ç‚¹æ—¶ï¼Œmapæ•°æ®æ¸…é™¤å­èŠ‚ç‚¹
 */
const deleteChildrenMap = (changeValueMap: CheckValueMap, childrenKeys: number[] | undefined) => {
  childrenKeys?.forEach((item) => {
    if (changeValueMap.has(item)) {
      changeValueMap.delete(item);
    }
  });
  return changeValueMap;
};

/**
 * å–æ¶ˆå‹¾é€‰/å‹¾é€‰ç¥–å…ˆèŠ‚ç‚¹æ—¶ï¼Œchildrenæ•°ç»„è”åŠ¨ï¼ˆæ‰€æœ‰ä¸‹çº§éƒ¨é—¨å…¨è¢«å–æ¶ˆå‹¾é€‰/å‹¾é€‰ï¼Œç¦ç”¨èŠ‚ç‚¹é™¤å¤–ï¼‰
 */
const linkageChildren = (
  treeEntities: TreeEntities,
  checkedKeysSet: Set<number>,
  childrenKeys: number[] | undefined,
  operate: ValueOf<typeof OPERATE> = OPERATE.ADD
) => {
  childrenKeys?.forEach((item) => {
    if (treeEntities.get(item)?.rawData.hasAuth) {
      checkedKeysSet[operate](item);
    }
  });
  return checkedKeysSet;
};

/**
 * æ”¶é›†ç¦ç”¨èŠ‚ç‚¹
 */
const gatherDisableNode = (
  parentItem: number,
  isIncludeSubMode: boolean,
  treeDataEntities: TreeEntities,
  changeValueMap: CheckValueMap,
  disabledNode: number[]
) => {
  // ç›´æ¥å­çº§éƒ½è°ƒæ•´ä¸ºå«ä¸‹çº§
  const directChildrenKeys = treeDataEntities.get(parentItem)?.directChildrenKeys;
  directChildrenKeys?.forEach((child) => {
    changeValueMap.set(
      child,
      isIncludeSubMode
        ? {
            name: treeDataEntities.get(child)?.rawData.name as string,
            includeSub: true,
          }
        : { name: treeDataEntities.get(child)?.rawData.name as string }
    );
    if (!treeDataEntities.get(child)?.rawData.hasAuth) {
      disabledNode.push(child);
    }
  });
};

/**
 * å–æ¶ˆèŠ‚ç‚¹æ—¶ï¼Œéƒ¨é—¨æ ‘åŒ…å«ç¦ç”¨èŠ‚ç‚¹çš„é€»è¾‘å¤„ç†
 */
const disableNodeHandle = (
  disabledNode: number[],
  changeValueMap: CheckValueMap,
  checkedKeysSet: Set<number>,
  treeDataEntities: TreeEntities,
  isIncludeSubMode: boolean
) => {
  disabledNode.forEach((item) => {
    changeValueMap.delete(item);
    const showChild = (directChildren: number[] | undefined) => {
      directChildren?.forEach((child) => {
        if (checkedKeysSet.has(child)) {
          changeValueMap.set(
            child,
            isIncludeSubMode
              ? {
                  name: treeDataEntities.get(child)?.rawData.name as string,
                  includeSub: true,
                }
              : {
                  name: treeDataEntities.get(child)?.rawData.name as string,
                }
          );
        } else if (!treeDataEntities.get(child)?.rawData.hasAuth) {
          showChild(treeDataEntities.get(child)?.directChildrenKeys);
        }
      });
    };
    showChild(treeDataEntities.get(item)?.directChildrenKeys);
  });
};

/**
 * å«ä¸‹çº§æ¨¡å¼ä¸‹ï¼Œå–æ¶ˆå‹¾é€‰èŠ‚ç‚¹æ—¶ï¼ŒchangeValueä¸­å«ä¸‹çº§çš„ç¥–å…ˆéƒ¨é—¨éƒ½è°ƒæ•´ä¸ºä¸å«ä¸‹çº§çŠ¶æ€ï¼ŒåŒæ—¶é‚»å±…èŠ‚ç‚¹éƒ½è°ƒæ•´ä¸ºå«ä¸‹çº§çŠ¶æ€ã€‚
 */
const linkageParents = (
  changeValueMap: CheckValueMap,
  parentKeys: number[] | undefined,
  checkedKeysSet: Set<number>,
  treeDataEntities: TreeEntities
) => {
  const disabledNode: number[] = [];
  parentKeys?.forEach((item) => {
    if (changeValueMap.has(item) && changeValueMap.get(item)?.includeSub) {
      changeValueMap.set(item, {
        name: changeValueMap.get(item)?.name as string,
        includeSub: false,
      });
      gatherDisableNode(item, true, treeDataEntities, changeValueMap, disabledNode);
    }
  });
  disableNodeHandle(disabledNode, changeValueMap, checkedKeysSet, treeDataEntities, true);
  return changeValueMap;
};

/**
 * æ™®é€šæ¨¡å¼ä¸‹ï¼Œå–æ¶ˆå‹¾é€‰èŠ‚ç‚¹æ—¶ï¼ŒchangeValueå’ŒcheckedKeysä¸­çš„ç¥–å…ˆéƒ¨é—¨éƒ½æ¸…é™¤ï¼ŒchangeValueä¸­æ·»åŠ é€‰ä¸­çš„é‚»å±…èŠ‚ç‚¹ã€‚
 */
const defaultLinkParents = (
  changeValueMap: CheckValueMap,
  checkedKeysSet: Set<number>,
  parentKeys: number[] | undefined,
  treeDataEntities: TreeEntities
) => {
  const disabledNode: number[] = [];
  parentKeys?.forEach((item) => {
    if (changeValueMap.has(item)) {
      changeValueMap.delete(item);
      gatherDisableNode(item, false, treeDataEntities, changeValueMap, disabledNode);
    }
    if (checkedKeysSet.has(item)) {
      checkedKeysSet.delete(item);
    }
  });
  disableNodeHandle(disabledNode, changeValueMap, checkedKeysSet, treeDataEntities, false);
  return [changeValueMap, checkedKeysSet];
};

/**
 * æ™®é€šæ¨¡å¼ä¸‹ï¼Œå‹¾é€‰èŠ‚ç‚¹æ—¶ï¼Œåˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦åº”è¯¥è¢«å‹¾é€‰
 */
const judgeParentChecked = (
  directChildren: number[] | undefined,
  checkedKeysSet: Set<number>,
  treeDataEntities: TreeEntities
): boolean | undefined => {
  return directChildren?.every((child) => {
    if (checkedKeysSet.has(child)) {
      return true;
    } else if (!treeDataEntities.get(child)?.rawData.hasAuth) {
      const childs = treeDataEntities.get(child)?.directChildrenKeys;
      return judgeParentChecked(childs, checkedKeysSet, treeDataEntities);
    }
    return false;
  });
};

```
ç»„ä»¶å†…éƒ¨ï¼ŒæŠŠç”¨æˆ·çš„è¡Œä¸ºæ“ä½œæ”¾åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œé¢ï¼Œè™½ç„¶å¤šäº†äº›åˆ¤æ–­æ¡ä»¶ï¼Œä½†è‡³å°‘ä»£ç ä¸ä¼šæ˜¾å¾—é‚£ä¹ˆå†—ä½™
```ts
  /**
   * èŠ‚ç‚¹çŠ¶æ€æ”¹å˜
   * @param node æ”¹å˜çš„èŠ‚ç‚¹
   * @param status èŠ‚ç‚¹æ·»åŠ æˆ–è€…åˆ é™¤
   * @param type å‹¾é€‰å–æ¶ˆèŠ‚ç‚¹æˆ–è€…ç‚¹å‡»ä¸å«/å«ä¸‹çº§
   */
  const nodeStatusChange = (
    node: DepartTreeData | DepartValue | undefined,
    status: boolean | undefined,
    type: ValueOf<typeof Check_Or_Include>
  ) => {
    let checkedKeysSet = new Set<number>((node ? checkedKeys : []) as CheckedKeys<true>);
    let changeValueMap = new Map(node ? changeValue : null);
    if (node) {
      // å•ä¸ªæ“ä½œ
      const operate = status ? OPERATE.DELETE : OPERATE.ADD;
      if (type === Check_Or_Include.CHECK) {
        checkedKeysSet[operate](node.orgId);
      }
      const childrenKeys = treeDataEntities.get(node.orgId)?.childrenKeys;
      checkedKeysSet = linkageChildren(treeDataEntities, checkedKeysSet, childrenKeys, operate);
      if (status) {
        // å–æ¶ˆå‹¾é€‰èŠ‚ç‚¹æˆ–è€…ç‚¹å‡»ä¸å«ä¸‹çº§
        const parentKeys = treeDataEntities.get(node.orgId)?.parentKeys;
        if (isIncludeSubMode) {
          changeValueMap = linkageParents(
            changeValueMap,
            type === Check_Or_Include.CHECK ? parentKeys : parentKeys?.concat(node.orgId),
            checkedKeysSet,
            treeDataEntities
          );
        } else {
          [changeValueMap, checkedKeysSet] = defaultLinkParents(
            changeValueMap,
            checkedKeysSet,
            parentKeys,
            treeDataEntities
          ) as [CheckValueMap, Set<number>];
        }
        if (type === Check_Or_Include.CHECK) {
          changeValueMap.delete(node.orgId);
        } else {
          changeValueMap.set(node.orgId, { name: node.name, includeSub: false });
        }
      } else {
        // å‹¾é€‰èŠ‚ç‚¹æˆ–è€…ç‚¹å‡»å«ä¸‹çº§
        if (isIncludeSubMode) {
          changeValueMap.set(node.orgId, { name: node.name, includeSub: true });
        } else {
          changeValueMap.set(node.orgId, { name: node.name });
          checkedKeysSet[operate](node.orgId);
          const parentKeys = treeDataEntities.get(node.orgId)?.parentKeys.reverse();
          parentKeys?.forEach((item) => {
            if (!treeDataEntities.get(item)?.rawData.hasAuth) {
              return;
            }
            const directChildrenKeys = treeDataEntities.get(item)?.directChildrenKeys;
            const equalAllChecked = judgeParentChecked(
              directChildrenKeys,
              checkedKeysSet,
              treeDataEntities
            );
            if (equalAllChecked) {
              checkedKeysSet[operate](item);
              changeValueMap.set(item, {
                name: treeDataEntities.get(item)?.rawData.name as string,
              });
              const deleteChilds = treeDataEntities.get(item)?.childrenKeys;
              changeValueMap = deleteChildrenMap(changeValueMap, deleteChilds);
            }
          });
        }
      }
      changeValueMap = deleteChildrenMap(changeValueMap, childrenKeys);
    }
    setCheckedKeys([...checkedKeysSet] as CheckedKeys<M>);
    mapChangeArr(changeValueMap);
    setIsNeedChange(false);
  };

  /**
   * ç‚¹å‡»èŠ‚ç‚¹
   */
  const nodeSelectChange = (
    keys: number | null,
    node: DepartTreeData,
    { checkboxStatus }: { checkboxStatus?: boolean | undefined }
  ) => {
    if (multiple) {
      nodeStatusChange(node, checkboxStatus, Check_Or_Include.CHECK);
    } else {
      const changeValueMap = new Map();
      if (keys || keys === 0) {
        changeValueMap.set(node.orgId, { name: node.name });
        setCheckedKeys(node.orgId as CheckedKeys<M>);
      } else {
        setCheckedKeys(null);
      }
      mapChangeArr(changeValueMap);
      // æœç´¢é€‰ä¸­åç»„ä»¶blur
      selectRef.current?.blur();
    }
  };

  /**
   * ç‚¹å‡»ä¸å«/å«ä¸‹çº§
   */
  const handleDepartLink = (
    e: React.MouseEvent,
    node: DepartTreeData,
    includeSub: boolean | undefined
  ) => {
    e.stopPropagation();
    nodeStatusChange(node, includeSub, Check_Or_Include.INCLUDE);
  };
```
è¿™äº›çœŸæ˜¯å†™çš„å¤´å¤§å‘€ï¼Œè¿˜æ˜¯çœ‹ä¸‹æœ€ç»ˆå®ç°æ•ˆæœå¼€å¿ƒä¸€ä¸‹å§ã€‚å“ˆå“ˆï½
### SelectTree
{% 
    dplayer     
    "url=/resources/depart6.mp4"  //è®¾ç½®è§†é¢‘ç›®å½•ï¼Œè¿™é‡Œæˆ‘æ”¾åœ¨äº†ç½‘ç«™æ ¹ç›®å½•ä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯publicç›®å½•ä¸‹é¢ 
    "pic=/resources/depart7.png" //è®¾ç½®å°é¢å›¾ï¼ŒåŒæ ·æ˜¯æ”¾åœ¨æ ¹ç›®å½•ä¸‹é¢ 
    "loop=yes"  //å¾ªç¯æ’­æ”¾
    "theme=#FADFA3"   //ä¸»é¢˜
    "autoplay=true"  //è‡ªåŠ¨æ’­æ”¾
    "screenshot=true" //å…è®¸æˆªå±
    "hotkey=true" //å…è®¸hotKeyï¼Œæ¯”å¦‚ç‚¹å‡»ç©ºæ ¼æš‚åœè§†é¢‘ç­‰æ“ä½œ
    "preload=auto" //é¢„åŠ è½½ï¼šauto
    "volume=0.9"  //åˆå§‹éŸ³é‡
    "playbackSpeed=1"//æ’­æ”¾é€Ÿåº¦1å€é€Ÿï¼Œå¯ä»¥é€‰æ‹©1.5,2ç­‰
    "lang=zh-cn"//è¯­è¨€
    "mutex=true"//æ’­æ”¾äº’æ–¥ï¼Œå°±æ¯”å¦‚å…¶ä»–è§†é¢‘æ’­æ”¾å°±ä¼šå¯¼è‡´è¿™ä¸ªè§†é¢‘è‡ªåŠ¨æš‚åœ
%}
### FilterTree
{% 
    dplayer     
    "url=/resources/depart8.mp4"  //è®¾ç½®è§†é¢‘ç›®å½•ï¼Œè¿™é‡Œæˆ‘æ”¾åœ¨äº†ç½‘ç«™æ ¹ç›®å½•ä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯publicç›®å½•ä¸‹é¢ 
    "pic=/resources/depart9.png" //è®¾ç½®å°é¢å›¾ï¼ŒåŒæ ·æ˜¯æ”¾åœ¨æ ¹ç›®å½•ä¸‹é¢ 
    "loop=yes"  //å¾ªç¯æ’­æ”¾
    "theme=#FADFA3"   //ä¸»é¢˜
    "autoplay=true"  //è‡ªåŠ¨æ’­æ”¾
    "screenshot=true" //å…è®¸æˆªå±
    "hotkey=true" //å…è®¸hotKeyï¼Œæ¯”å¦‚ç‚¹å‡»ç©ºæ ¼æš‚åœè§†é¢‘ç­‰æ“ä½œ
    "preload=auto" //é¢„åŠ è½½ï¼šauto
    "volume=0.9"  //åˆå§‹éŸ³é‡
    "playbackSpeed=1"//æ’­æ”¾é€Ÿåº¦1å€é€Ÿï¼Œå¯ä»¥é€‰æ‹©1.5,2ç­‰
    "lang=zh-cn"//è¯­è¨€
    "mutex=true"//æ’­æ”¾äº’æ–¥ï¼Œå°±æ¯”å¦‚å…¶ä»–è§†é¢‘æ’­æ”¾å°±ä¼šå¯¼è‡´è¿™ä¸ªè§†é¢‘è‡ªåŠ¨æš‚åœ
%}